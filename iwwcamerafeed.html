<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Iron Well • Command Center</title>
<style>
  :root{
    --bg:#0b0b0d; --panel:#14151c; --ring:#2a2a30; --text:#e9f0ff; --muted:#8ea0b8;
    --accent:#6bdcff; --ok:#4be38f; --warn:#ff6b6b; --rad:14px; --shadow:0 10px 26px rgba(0,0,0,.45);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; background:var(--bg) center/cover fixed no-repeat; color:var(--text);
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
  }

  .topbar{
    position:sticky; top:0; z-index:10; backdrop-filter: blur(6px);
    background: linear-gradient(180deg, rgba(20,21,28,.85), rgba(20,21,28,.6));
    border-bottom:1px solid #1d1f27; padding:10px 14px; display:flex; align-items:center; gap:10px;
  }
  .title{font-weight:700; letter-spacing:.4px}
  .spacer{flex:1}
  .btn{
    appearance:none; border:1px solid #2a2f3a; background:#1a1d26; color:var(--text);
    padding:8px 12px; border-radius:10px; font-weight:600; cursor:pointer;
  }
  .btn:hover{border-color:#3b4150}
  .btn:active{transform:translateY(1px)}
  .btn[disabled]{opacity:.5; cursor:not-allowed}

  .wall{
    padding:12px; display:grid; gap:12px;
    grid-template-columns: repeat(2, minmax(0, 1fr)); /* mobile-first */
  }
  @media (min-width: 900px){
    .wall{grid-template-columns: repeat(3, minmax(0, 1fr));}
  }

  .tile{
    position:relative; border-radius:var(--rad); overflow:hidden; background:#0e0f14;
    border:1px solid var(--ring); box-shadow:var(--shadow);
    aspect-ratio: 16 / 9; isolation:isolate; cursor:pointer;
  }
  .tile video{
    width:100%; height:100%; object-fit:cover; display:block; background:#000;
  }
  .hud{
    position:absolute; inset:0; pointer-events:none;
    display:flex; flex-direction:column; justify-content:space-between; padding:8px;
  }
  .row{display:flex; align-items:center; gap:8px}
  .row.right{justify-content:flex-end}
  .badge{
    background:rgba(0,0,0,.45); border:1px solid rgba(255,255,255,.18);
    padding:6px 10px; border-radius:999px; font-weight:700; font-size:12px;
    box-shadow:0 0 0 1px rgba(0,0,0,.2) inset;
  }
  .cam{letter-spacing:.6px}
  .rec{color:var(--warn)}
  .rec .dot{
    display:inline-block; width:8px; height:8px; border-radius:50%; background:var(--warn);
    margin-right:6px; animation: blink 1.2s infinite;
  }
  @keyframes blink{0%,60%{opacity:1} 61%,100%{opacity:.2}}

  .clock{color:var(--muted); font-weight:700}
  .controls{
    position:absolute; inset:auto 8px 8px 8px; display:flex; gap:8px; justify-content:space-between;
    pointer-events:auto;
  }
  .mini{
    background:rgba(0,0,0,.55); color:var(--text);
    border:1px solid rgba(255,255,255,.18); border-radius:10px; padding:6px 10px;
    font-weight:700; font-size:12px; cursor:pointer;
  }
  .mini:active{transform:translateY(1px)}
  .nosignal{
    position:absolute; inset:0; background:repeating-linear-gradient(90deg, #111 0 2px, #0e0e0e 2px 4px);
    color:#bbb; display:flex; align-items:center; justify-content:center; font-weight:800;
    letter-spacing:1px; text-shadow:0 1px 0 #000; font-size:14px;
  }

  /* Lightbox overlay */
  .lightbox{
    position:fixed; inset:0; z-index:50;
    background: radial-gradient(120% 120% at 50% 40%, rgba(0,0,0,.75), rgba(0,0,0,.95));
    display:flex; align-items:center; justify-content:center;
    padding:16px; animation: fadeIn .15s ease-out;
  }
  @keyframes fadeIn{from{opacity:0} to{opacity:1}}
  .lbFrame{
    width:100%; max-width:1100px; height:72vh; max-height:90vh;
    border-radius:16px; overflow:hidden; border:1px solid var(--ring); background:#000; position:relative;
  }
  .lightbox video{width:100%; height:100%; object-fit:contain; background:#000;}
  .lbHud{
    position:absolute; inset:0; pointer-events:none; padding:10px; display:flex; flex-direction:column; justify-content:space-between;
  }
  .lbHint{
    background:rgba(0,0,0,.5); border:1px solid rgba(255,255,255,.18);
    padding:6px 10px; border-radius:999px; font-weight:800; font-size:12px; color:var(--muted);
  }

  /* When a tile's video has been popped out */
  .tile.popped::after{
    content:"TAP AGAIN TO RETURN";
    position:absolute; inset:auto 8px 8px auto; pointer-events:none;
    background:rgba(0,0,0,.45); color:#cfd7ee; font-weight:800; font-size:11px;
    padding:6px 10px; border-radius:999px; border:1px solid rgba(255,255,255,.15);
  }
</style>
</head>
<body>
  <header class="topbar">
    <div class="title">IRON WELL • Command Center</div>
    <div class="spacer"></div>
    <button class="btn" id="shuffleBtn">Shuffle Order</button>
    <button class="btn" id="startBtn">Start Feeds</button>
  </header>

  <main class="wall" id="wall"></main>

<script>
  // --- CONFIG ---
  const sources = [
    {cam:1, src:"iwwvideo1.mp4"},
    {cam:2, src:"iwwvideo2.mp4"},
    {cam:3, src:"iwwvideo3.mp4"},
    {cam:4, src:"iwwvideo4.mp4"},
    {cam:5, src:"iwwvideo5.mp4"},
    {cam:6, src:"iwwvideo6.mp4"},
  ];
  // Out-of-order initial layout
  let order = [4,1,6,2,5,3];

  const wall = document.getElementById('wall');
  const shuffleBtn = document.getElementById('shuffleBtn');
  const startBtn = document.getElementById('startBtn');

  let lightbox = null;              // overlay element
  let popped = null;                // {tile, video, placeholder, cam}

  function render(){
    wall.innerHTML = "";
    order.forEach(camNum => {
      const camData = sources.find(s => s.cam === camNum);
      wall.appendChild(makeTile(camData));
    });
  }

  function makeTile({cam, src}){
    const el = document.createElement('section');
    el.className = 'tile';
    el.dataset.cam = String(cam).padStart(2,'0');
    el.setAttribute('role', 'button');
    el.setAttribute('aria-label', `Open camera ${el.dataset.cam}`);

    const v = document.createElement('video');
    v.src = src; v.autoplay = true; v.loop = true; v.muted = true;
    v.playsInline = true; v.setAttribute('playsinline','');

    v.addEventListener('error', () => showNoSignal(el));

    const hud = document.createElement('div');
    hud.className = 'hud';
    hud.innerHTML = `
      <div class="row">
        <div class="badge cam">CAM ${String(cam).padStart(2,'0')}</div>
        <div class="badge rec"><span class="dot"></span>REC</div>
      </div>
      <div class="row right">
        <div class="badge clock" data-clock></div>
      </div>
    `;

    const controls = document.createElement('div');
    controls.className = 'controls';
    controls.innerHTML = `
      <button class="mini" data-act="play">Pause</button>
      <div style="display:flex; gap:8px;">
        <button class="mini" data-act="mute">Unmute</button>
      </div>
    `;
    // prevent tile-click from firing when pressing a control
    controls.addEventListener('click', (e) => {
      e.stopPropagation();
      const btn = e.target.closest('button'); if(!btn) return;
      const act = btn.dataset.act;
      if(act === 'play'){
        if(v.paused){ v.play(); btn.textContent = 'Pause'; }
        else { v.pause(); btn.textContent = 'Play'; }
      }
      if(act === 'mute'){
        v.muted = !v.muted;
        if(!v.muted){ v.play().catch(()=>{}); }
        btn.textContent = v.muted ? 'Unmute' : 'Mute';
      }
    });

    // click or tap the tile to open lightbox
    el.addEventListener('click', () => openLightbox(el));

    el.appendChild(v);
    el.appendChild(hud);
    el.appendChild(controls);
    return el;
  }

  function showNoSignal(tile){
    if(tile.querySelector('.nosignal')) return;
    const overlay = document.createElement('div');
    overlay.className = 'nosignal';
    overlay.textContent = 'NO SIGNAL';
    tile.appendChild(overlay);
  }

  // Lightbox logic
  function openLightbox(tile){
    if(lightbox) return; // already open
    const video = tile.querySelector('video');
    const placeholder = document.createElement('div');
    placeholder.style.width = '100%';
    placeholder.style.height = '100%';
    placeholder.style.background = '#000';
    tile.classList.add('popped');
    tile.insertBefore(placeholder, video); // mark spot

    // overlay
    lightbox = document.createElement('div');
    lightbox.className = 'lightbox';
    lightbox.setAttribute('role','dialog');
    lightbox.setAttribute('aria-label', `Camera ${tile.dataset.cam} expanded view`);

    const frame = document.createElement('div');
    frame.className = 'lbFrame';

    // HUD inside overlay
    const lbHud = document.createElement('div');
    lbHud.className = 'lbHud';
    lbHud.innerHTML = `
      <div class="row">
        <div class="badge cam">CAM ${tile.dataset.cam}</div>
        <div class="badge rec"><span class="dot"></span>REC</div>
      </div>
      <div class="row right">
        <div class="badge clock" data-clock></div>
        <div class="lbHint" style="margin-left:8px">Tap anywhere to close</div>
      </div>
    `;

    frame.appendChild(video); // move video into overlay (preserves playback state)
    frame.appendChild(lbHud);
    lightbox.appendChild(frame);
    document.body.appendChild(lightbox);

    // close on any click/tap (including on video)
    lightbox.addEventListener('click', closeLightbox, { once:false });

    // keyboard escape
    window.addEventListener('keydown', escClose);

    // disable shuffle while open to avoid layout surprises
    shuffleBtn.disabled = true;

    popped = { tile, video, placeholder, cam: tile.dataset.cam };
  }

  function closeLightbox(){
    if(!lightbox || !popped) return;
    const {tile, video, placeholder} = popped;
    // return video to its original tile
    tile.replaceChild(video, placeholder);
    tile.classList.remove('popped');

    // remove overlay
    lightbox.remove();
    lightbox = null;
    popped = null;

    // re-enable shuffle
    shuffleBtn.disabled = false;

    // remove key handler
    window.removeEventListener('keydown', escClose);
  }

  function escClose(e){ if(e.key === 'Escape') closeLightbox(); }

  // Live clock in tiles and overlay
  function tickClock(){
    const now = new Date();
    const hh = String(now.getHours()).padStart(2,'0');
    const mm = String(now.getMinutes()).padStart(2,'0');
    const ss = String(now.getSeconds()).padStart(2,'0');
    document.querySelectorAll('[data-clock]').forEach(el => el.textContent = `${hh}:${mm}:${ss}`);
  }
  setInterval(tickClock, 500);
  tickClock();

  // Shuffle order (disabled if lightbox open)
  shuffleBtn.addEventListener('click', () => {
    if(lightbox) return;
    order = order.map(n => [Math.random(), n]).sort((a,b) => a[0]-b[0]).map(x => x[1]);
    render();
  });

  // Start feeds button (mobile autoplay nudge)
  startBtn.addEventListener('click', () => {
    document.querySelectorAll('video').forEach(v => v.play().catch(()=>{}));
  });

  // Initial render
  render();
</script>
</body>
</html>
