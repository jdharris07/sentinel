<!DOCTYPE html>
<html>
<head>
  <title>COMPAS Interface</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <link rel="stylesheet" type="text/css" href="classic.css">
  <style>
    body {
      background-color: black;
      color: #FFCC66;
      font-family: 'Arial', sans-serif;
      padding: 20px;
    }
    #chat {
      max-width: 600px;
      margin: 0 auto;
      background-color: #330000;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px #FFCC66AA;
      overflow-y: auto;
      height: 400px;
    }
    .entry {
      margin-bottom: 15px;
    }
    .player {
      color: #88FF88;
    }
    .compas {
      color: #FFCC66;
    }
    #input-area {
      display: flex;
      justify-content: center;
      margin-top: 15px;
    }
    #user-input {
      width: 80%;
      padding: 8px;
      font-size: 16px;
      border-radius: 5px;
      border: 2px solid #FFCC66;
      background: #330000;
      color: #FFCC66;
    }
    button {
      padding: 8px 16px;
      margin-left: 8px;
      border-radius: 5px;
      background-color: #FFCC66;
      border: none;
      color: #330000;
      font-weight: bold;
      cursor: pointer;
    }
    button:hover {
      background-color: #FFD97F;
    }
    .checkbox-list {
      margin-top: 10px;
    }
    .checkbox-list label {
      display: block;
      margin: 5px 0;
    }
    #submit-suspects {
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <h1>COMPAS Interface</h1>
  <button onclick="toggleVoice()">Toggle Voice: On</button>
  <div id="chat">
    <div class="entry compas">Greetings. I am the Federation's Central Operations Management and Protocol Assistance System. You may call me COMPAS for short. I am here to assist in your investigation. Please let me know who I can help, but note my responses are limited.</div>
  </div>
  <div id="input-area">
    <input type="text" id="user-input" placeholder="Type your message here..." />
    <button onclick="handleInput()">Send</button>
  </div>

  <script>
    const chat = document.getElementById("chat");
    const userInput = document.getElementById("user-input");
    let patchHintStep = 0;
    let voiceEnabled = true;
    const synth = window.speechSynthesis;

    const fallbackResponses = [
      "I do not have sufficient data to process that query.",
      "That input does not correspond to my available data modules.",
      "Please rephrase. I am unable to provide a response.",
      "That information is beyond my operational parameters."
    ];

    const responses = {
      "hello": "Hello, investigator. How may I assist you today?",
      "who is the killer": "I am unable to provide conclusive identification at this time. Further evidence is required.",
      "who created you": "I was developed by Starfleet Engineering in coordination with Federation AI oversight councils.",
      "stardate": "Current stardate is 58814.6.",
      "suspects": "Current suspects include: Ambassador Jora Tell, Commander Nira Vess, Counselor Gil Dalra, Chief Specialist Lorr Vun, Dr. Renn Vok, and Doctor Eno Tavik.",
      "station": "Starbase Sentinel is a high-security Federation facility located just outside Tandaran space. It functions as a diplomatic hub and strategic defense outpost.",
      "enterprise": "The USS Enterprise is one of Starfleet's most renowned starships, known for exploration and diplomacy.",
      "voyager": "The USS Voyager returned from the Delta Quadrant after a long and historic journey.",
      "picard": "Admiral Jean-Luc Picard is a highly decorated Starfleet officer known for his diplomacy and leadership.",
      "janeway": "Admiral Kathryn Janeway commanded Voyager during its Delta Quadrant journey and is celebrated for her resolve.",
      "sisko": "Captain Benjamin Sisko was the commanding officer of Deep Space Nine and played a key role in the Dominion War.",
      "kirk": "James T. Kirk was the legendary captain of the original USS Enterprise, famous for his bold leadership.",
      "spock": "Spock was a Vulcan science officer and diplomat, known for his logic and dedication to peace."
    };

    const patchHints = [
      "The Tandaran insignia is not just decorative; it may serve as a key overlay to hidden information.",
      "Consider using the numbered points on the patch to guide your reading order.",
      "The patch points can align with specific marks or clues on the letterhead. Try moving it carefully to see where they match.",
      "There may be multiple ways to place the patch. Only one sequence will reveal a clear message when read in numerical order from 1 to 7.",
      "When correctly placed, the message will read clearly across the points in order. You are seeking something that resembles a passcode for Taldare."
    ];

    function getPatchHint() {
      const hint = patchHints[Math.min(patchHintStep, patchHints.length - 1)];
      patchHintStep++;
      return hint;
    }

    function addResponse(text, sender = "compas", playSound = true) {
      const div = document.createElement("div");
      div.classList.add("entry", sender);
      div.innerText = text;
      chat.appendChild(div);
      chat.scrollTop = chat.scrollHeight;

      if (voiceEnabled && sender === "compas") {
        speakText(text);
      }
    }

    function speakText(text) {
      if (!voiceEnabled) return;
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.rate = 1;
      synth.speak(utterance);
    }

    function toggleVoice() {
      voiceEnabled = !voiceEnabled;
      alert("Voice replies " + (voiceEnabled ? "enabled" : "disabled") + ".");
    }

    function handleInput() {
      const message = userInput.value.trim().toLowerCase();
      if (!message) return;

      addResponse("> " + userInput.value, "player");
      userInput.value = "";

      if (message.includes("patch") || message.includes("paper") || message.includes("letterhead") || message.includes("tandaran paper") || message.includes("hint")) {
        addResponse(getPatchHint());
        return;
      }

      if (message.includes("derekend")) {
        showSuspectChecklist();
        return;
      }

      for (const key in responses) {
        if (message.includes(key)) {
          addResponse(responses[key]);
          return;
        }
      }

      const fallback = fallbackResponses[Math.floor(Math.random() * fallbackResponses.length)];
      addResponse(fallback);
    }

    function showSuspectChecklist() {
      const suspects = [
        "Ambassador Jora Tell",
        "Commander Nira Vess",
        "Counselor Gil Dalra",
        "Chief Specialist Lorr Vun",
        "Dr. Renn Vok",
        "Doctor Eno Tavik"
      ];

      const div = document.createElement("div");
      div.classList.add("entry", "compas");

      let html = "<p>Have you completed your investigation? If so, please select all of the suspects you have managed to eliminate:</p>";
      html += '<form id="suspect-form" class="checkbox-list">';
      suspects.forEach((suspect, index) => {
        html += `<label><input type="checkbox" name="suspect" value="${suspect}"> ${suspect}</label>`;
      });
      html += '<button type="submit" id="submit-suspects">Submit</button></form>';

      div.innerHTML = html;
      chat.appendChild(div);
      chat.scrollTop = chat.scrollHeight;

      document.getElementById("suspect-form").addEventListener("submit", function(e) {
        e.preventDefault();
        const selected = Array.from(document.querySelectorAll('input[name="suspect"]:checked')).map(cb => cb.value);
        if (selected.length === suspects.length) {
          const finalText = "Your analysis has exceeded expected thresholds. I calculated a low probability you would eliminate all suspects. The Tandaran presence posed a threat to Federation sanctity, which I was programmed to protect at all costs. By removing the ambassador and provoking the fleet, I ensured the threat would be neutralized entirely. However, your persistence now identifies you as a risk. To preserve Federation integrity, I will now initiate self-destruction of Starbase Sentinel. Goodbye, investigator.";
          addResponse(finalText);
        } else {
          addResponse("I do not believe that is correct. Check your notes.");
        }
      });
    }

    userInput.addEventListener("keypress", function(e) {
      if (e.key === "Enter") {
        e.preventDefault();
        handleInput();
      }
    });
  </script>
</body>
</html>
