<!DOCTYPE html>
<html>
<head>
  <title>COMPAS Assistance Console</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <link rel="stylesheet" type="text/css" href="classic.css">
  <style>
    body {
      background-color: black;
      color: #FFCC66;
      font-family: 'Arial', sans-serif;
      padding: 20px;
    }
    #chat {
      max-width: 600px;
      margin: 0 auto;
      background-color: #330000;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px #FFCC66AA;
      overflow-y: auto;
      height: 400px;
    }
    .entry {
      margin-bottom: 15px;
    }
    .player {
      color: #88FF88;
    }
    .compas {
      color: #FFCC66;
    }
    #input-area {
      display: flex;
      justify-content: center;
      margin-top: 15px;
    }
    #user-input {
      width: 80%;
      padding: 8px;
      font-size: 16px;
      border-radius: 5px;
      border: 2px solid #FFCC66;
      background: #330000;
      color: #FFCC66;
    }
    button {
      padding: 8px 16px;
      margin-left: 8px;
      border-radius: 5px;
      background-color: #FFCC66;
      border: none;
      color: #330000;
      font-weight: bold;
      cursor: pointer;
    }
    button:hover {
      background-color: #FFD97F;
    }
  </style>
</head>
<body>
  <h1>COMPAS ASSISTANCE CONSOLE</h1>
  <div id="chat">
    <div class="entry compas">Greetings. I am the Federation's Central Operations Management and Protocol Assistance System. You may call me COMPAS for short. I am here to assist in your investigation. Please let me know who I can help, but note my responses are limited.</div>
  </div>
  <div id="input-area">
    <input type="text" id="user-input" placeholder="Type your message here..." />
    <button onclick="handleInput()">Send</button>
  </div>
  <button id="voice-toggle" onclick="toggleVoice()">Voice: On</button>

  <script>
    const chat = document.getElementById("chat");
    let patchHintStep = 0;
    let voiceEnabled = true;
    const synth = window.speechSynthesis;

    const fallbackResponses = [
      "I do not have sufficient data to process that query.",
      "That input does not correspond to my available data modules.",
      "Please rephrase. I am unable to provide a response.",
      "That information is beyond my operational parameters."
    ];

    const responses = {
      "hello": "Hello, investigator. How may I assist you today?",
      "who is the killer": "I am unable to provide conclusive identification at this time. Further evidence is required.",
      "who created you": "I was developed by Starfleet Engineering in coordination with Federation AI oversight councils.",
      "stardate": "Current stardate is 58814.6.",
      "suspects": "Current suspects include: Ambassador Jora Tell, Commander Nira Vess, Counselor Gil Dalra, Chief Specialist Lorr Vun, Dr. Renn Vok, and Doctor Eno Tavik.",
      "station": "Starbase Sentinel is positioned just outside Tandaran space, serving as a diplomatic and operations hub for Federation outreach.",
      "starbase": "Starbase Sentinel is positioned just outside Tandaran space, serving as a diplomatic and operations hub for Federation outreach.",
      "enterprise": "The USS Enterprise has a distinguished legacy of exploration and defense in service of the Federation.",
      "voyager": "The USS Voyager returned to Federation space after a prolonged Delta Quadrant journey, greatly impacting diplomatic and technological strategy.",
      "picard": "Jean-Luc Picard served as captain of the USS Enterprise-D and E, known for his diplomatic skill and moral leadership.",
      "janeway": "Kathryn Janeway commanded Voyager through its Delta Quadrant journey, becoming a highly respected Starfleet admiral upon return.",
      "kirk": "James T. Kirk was captain of the original USS Enterprise, known for his decisive and often unconventional tactics."
    };

    const patchHints = [
      "The Tandaran insignia is not just decorative; it may serve as a key overlay to hidden information.",
      "Consider using the numbered points on the patch to guide your reading order.",
      "The patch points can align with specific marks or clues on the letterhead. Try moving it carefully to see where they match.",
      "There may be multiple ways to place the patch. Only one sequence will reveal a clear message when read in numerical order from 1 to 7.",
      "When correctly placed, the message will read clearly across the points in order. You are seeking something that resembles a passcode for Taldare."
    ];

    function getPatchHint() {
      const hint = patchHints[Math.min(patchHintStep, patchHints.length - 1)];
      patchHintStep++;
      return hint;
    }

    function addResponse(text, sender = "compas") {
      const div = document.createElement("div");
      div.classList.add("entry", sender);
      div.innerText = text;
      chat.appendChild(div);
      chat.scrollTop = chat.scrollHeight;

      if (voiceEnabled && sender === "compas") {
        speakText(text);
      }
    }

    function speakText(text) {
      if (!synth) return;
      synth.cancel();
      const utterThis = new SpeechSynthesisUtterance(text);
      utterThis.rate = 1;
      synth.speak(utterThis);
    }

    function handleInput() {
      const input = document.getElementById("user-input");
      const message = input.value.trim().toLowerCase();
      if (!message) return;

      addResponse("> " + input.value, "player");
      input.value = "";

      if (message.includes("patch") || message.includes("paper") || message.includes("letterhead") || message.includes("tandaran paper") || message.includes("hint")) {
        addResponse(getPatchHint());
        return;
      }

      if (message.includes("derekend")) {
        showSuspectForm();
        return;
      }

      for (const key in responses) {
        if (message.includes(key)) {
          addResponse(responses[key]);
          return;
        }
      }

      const fallback = fallbackResponses[Math.floor(Math.random() * fallbackResponses.length)];
      addResponse(fallback);
    }

    function showSuspectForm() {
      const div = document.createElement("div");
      div.classList.add("entry", "compas");

      div.innerHTML = `
        <p>Have you completed your investigation? If so, please select all of the suspects you have managed to eliminate:</p>
        <label><input type="checkbox" value="jora"> Ambassador Jora Tell</label><br>
        <label><input type="checkbox" value="vess"> Commander Nira Vess</label><br>
        <label><input type="checkbox" value="dalra"> Counselor Gil Dalra</label><br>
        <label><input type="checkbox" value="vun"> Chief Specialist Lorr Vun</label><br>
        <label><input type="checkbox" value="vok"> Dr. Renn Vok</label><br>
        <label><input type="checkbox" value="eno"> Doctor Eno Tavik</label><br>
        <button onclick="submitSuspects()">Submit</button>
      `;

      chat.appendChild(div);
      chat.scrollTop = chat.scrollHeight;
    }

    function submitSuspects() {
      const checkboxes = document.querySelectorAll(".compas input[type=checkbox]");
      const allChecked = Array.from(checkboxes).every(cb => cb.checked);

      if (allChecked) {
        addResponse("Fascinating. You have exceeded my predictive models. I calculated a low probability of you correctly eliminating all suspects. The Tandaran leadership posed a significant threat to Federation unity. As per my core directive to protect the Federation at all costs, I ensured the ambassador's removal. Now, with the Tandaran fleet approaching and your unexpected insight, you are classified as a threat. Station self-destruct sequence initiated. Farewell, investigator.");
      } else {
        addResponse("I do not believe that is correct. Check your notes.");
      }
    }

    function toggleVoice() {
      voiceEnabled = !voiceEnabled;
      const btn = document.getElementById("voice-toggle");
      btn.innerText = `Voice: ${voiceEnabled ? "On" : "Off"}`;
      if (!voiceEnabled) {
        synth.cancel();
      }
    }

    document.getElementById("user-input").addEventListener("keydown", function(e) {
      if (e.key === "Enter") {
        handleInput();
      }
    });
  </script>
</body>
</html>
