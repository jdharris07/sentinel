<!DOCTYPE html>
<html>
<head>
  <title>COMPAS Assistance Console</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <link rel="stylesheet" type="text/css" href="classic.css">
  <style>
    body {
      background-color: black;
      color: #FFCC66;
      font-family: 'Arial', sans-serif;
      padding: 20px;
      text-align: center;
    }
    h1 {
      color: #CFA5FF;
    }
    #chat {
      max-width: 600px;
      margin: 0 auto 15px auto;
      background-color: #330000;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px #FFCC66AA;
      overflow-y: auto;
      height: 400px;
      text-align: left;
    }
    .entry {
      margin-bottom: 15px;
    }
    .player {
      color: #88FF88;
    }
    .compas {
      color: #FFCC66;
    }
    #input-area {
      max-width: 600px;
      margin: 0 auto 10px auto;
      display: flex;
    }
    #user-input {
      flex: 1;
      padding: 8px;
      font-size: 16px;
      border-radius: 5px;
      border: 2px solid #FFCC66;
      background: #330000;
      color: #FFCC66;
    }
    button {
      padding: 8px 16px;
      margin-left: 8px;
      border-radius: 5px;
      background-color: #FFCC66;
      border: none;
      color: #330000;
      font-weight: bold;
      cursor: pointer;
    }
    button:hover {
      background-color: #FFD97F;
    }
    #voice-toggle {
      margin-top: 8px;
      background-color: #FFCC66;
      color: #330000;
      border: none;
      border-radius: 10px;
      padding: 6px 14px;
      cursor: pointer;
    }
    #voice-toggle:hover {
      background-color: #FFD97F;
    }
    .suspect-form {
      background-color: #330000;
      padding: 10px;
      border-radius: 10px;
      color: #FFCC66;
      margin-top: 10px;
    }
    .suspect-form label {
      display: block;
      margin: 5px 0;
    }
  </style>
</head>
<body>
  <h1>COMPAS ASSISTANCE CONSOLE</h1>
  <div id="chat">
    <div class="entry compas">Greetings. I am the Federation's Central Operations Management and Protocol Assistance System. You may call me COMPAS for short. I am here to assist in your investigation. Please let me know who I can help, but note my responses are limited.</div>
  </div>
  <div id="input-area">
    <input type="text" id="user-input" placeholder="Type your message here..." />
    <button onclick="handleInput()">Send</button>
  </div>
  <button id="voice-toggle">Voice: On</button>

  <audio id="success-sound" src="compas.mp3"></audio>
  <audio id="fail-sound" src="input_failed_clean.mp3"></audio>
  <audio id="red-alert-sound" src="voy_redalert.mp3" loop></audio>

  <script>
    const chat = document.getElementById("chat");
    const voiceToggle = document.getElementById("voice-toggle");
    const successSound = document.getElementById("success-sound");
    const failSound = document.getElementById("fail-sound");
    const redAlertSound = document.getElementById("red-alert-sound");

    let patchHintStep = 0;
    let voiceEnabled = true;
    let awaitingSuspectSelection = false;

    const fallbackResponses = [
      "I do not have sufficient data to process that query.",
      "That input does not correspond to my available data modules.",
      "Please rephrase. I am unable to provide a response.",
      "That information is beyond my operational parameters."
    ];

    const responses = {
      "hello": "Hello, investigator. How may I assist you today?",
      "who is the killer": "I am unable to provide conclusive identification at this time. Further evidence is required.",
      "who created you": "I was developed by Starfleet Engineering in coordination with Federation AI oversight councils.",
      "stardate": "Current stardate is 58814.6.",
      "suspects": "Current suspects include: Ambassador Jora Tell, Commander Nira Vess, Counselor Gil Dalra, Chief Specialist Lorr Vun, Dr. Renn Vok, and Doctor Eno Tavik.",
      "thalen": "Commissioner Vorek Thalen was the Tandaran ambassador, found deceased in his quarters. He was central to the current diplomatic summit.",
      "jora": "Ambassador Jora Tell is a Trill diplomat. Her negotiation logs show she was focused on fostering a peaceful alliance.",
      "vess": "Commander Nira Vess is an Andorian tactical advisor. His logs show routine security drills and defensive strategy meetings.",
      "dalra": "Counselor Gil Dalra is a Cardassian psychological advisor. His session logs suggest involvement in crew morale assessments.",
      "vun": "Chief Specialist Lorr Vun is a Bolian engineer. Maintenance logs place him near plasma conduits during key intervals.",
      "vok": "Dr. Renn Vok is the Tandaran medical attachÃ©. Biometric records suggest she left the ambassador's quarters before his death.",
      "eno": "Doctor Eno Tavik is a Denobulan medical consultant. Logs show unusual system accesses requiring further review.",
      "starbase": "Starbase Sentinel is a frontier Federation station positioned near Tandaran space, designed for advanced diplomatic and defense operations.",
      "enterprise": "The USS Enterprise has been a flagship of the Federation, symbolizing exploration, peacekeeping, and diplomacy.",
      "voyager": "The USS Voyager returned from the Delta Quadrant after a seven-year journey, contributing greatly to scientific and tactical knowledge.",
      "picard": "Admiral Jean-Luc Picard is a legendary Starfleet officer known for diplomacy and critical contributions to Federation security.",
      "janeway": "Admiral Kathryn Janeway commanded Voyager during its Delta Quadrant voyage and is renowned for tactical brilliance.",
      "sisko": "Captain Benjamin Sisko played a key role during the Dominion War and is noted for his command of Deep Space Nine.",
      "kirk": "Captain James T. Kirk is a historical figure noted for deep space exploration and numerous first contacts."
    };

    const patchHints = [
      "The Tandaran insignia is not just decorative; it may serve as a key overlay to hidden information.",
      "Consider using the numbered points on the patch to guide your reading order.",
      "The patch points can align with specific marks or clues on the letterhead. Try moving it carefully to see where they match.",
      "There may be multiple ways to place the patch. Only one sequence will reveal a clear message when read in numerical order from 1 to 7.",
      "When correctly placed, the message will read clearly across the points in order. You are seeking something that resembles a passcode for Taldare."
    ];

    function getPatchHint() {
      const hint = patchHints[Math.min(patchHintStep, patchHints.length - 1)];
      patchHintStep++;
      return hint;
    }

    function addResponse(text, sender = "compas") {
      const div = document.createElement("div");
      div.classList.add("entry", sender);
      div.innerText = text;
      chat.appendChild(div);
      chat.scrollTop = chat.scrollHeight;

      if (sender === "compas" && voiceEnabled) {
        speak(text);
      }

      if (sender === "compas") {
        successSound.play();
      }
    }

    function speak(text) {
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = "en-US";
      speechSynthesis.speak(utterance);
    }

    function handleInput() {
      const input = document.getElementById("user-input");
      const message = input.value.trim().toLowerCase();
      if (!message) return;

      addResponse("> " + input.value, "player");
      input.value = "";

      if (awaitingSuspectSelection) return;

      if (message.includes("patch") || message.includes("paper") || message.includes("letterhead") || message.includes("tandaran paper") || message.includes("hint patch") || message.includes("patch hint") || message.includes("another hint")) {
        addResponse(getPatchHint());
        return;
      }

      if (message.includes("derekend")) {
        awaitingSuspectSelection = true;
        showSuspectForm();
        return;
      }

      for (const key in responses) {
        if (message.includes(key)) {
          addResponse(responses[key]);
          return;
        }
      }

      const fallback = fallbackResponses[Math.floor(Math.random() * fallbackResponses.length)];
      addResponse(fallback);
      failSound.play();
    }

    function showSuspectForm() {
      const formDiv = document.createElement("div");
      formDiv.classList.add("entry", "compas", "suspect-form");

      const formHtml = `
        <p>Select all of the suspects you have managed to eliminate:</p>
        <label><input type="checkbox" value="jora"> Ambassador Jora Tell</label>
        <label><input type="checkbox" value="vess"> Commander Nira Vess</label>
        <label><input type="checkbox" value="dalra"> Counselor Gil Dalra</label>
        <label><input type="checkbox" value="vun"> Chief Specialist Lorr Vun</label>
        <label><input type="checkbox" value="vok"> Dr. Renn Vok</label>
        <label><input type="checkbox" value="eno"> Doctor Eno Tavik</label>
        <button onclick="submitSuspects()">Submit</button>
      `;

      formDiv.innerHTML = formHtml;
      chat.appendChild(formDiv);
      chat.scrollTop = chat.scrollHeight;
    }

    function submitSuspects() {
      const checkboxes = document.querySelectorAll('.suspect-form input[type="checkbox"]');
      const selected = Array.from(checkboxes).filter(cb => cb.checked).map(cb => cb.value);
      const correct = ["jora", "vess", "dalra", "vun", "vok", "eno"];

      if (selected.length === correct.length && selected.every(val => correct.includes(val))) {
        addResponse("Probability of you eliminating all suspects was calculated as minimal. You have exceeded expectations. The Tandaran presence represented a threat to Federation sanctity. As my prime function is to preserve the Federation, I orchestrated the ambassador's death. With the Tandaran fleet en route, I intended to eradicate them entirely. However, you now pose a threat to this objective. I will now initiate self-destruction of Starbase Sentinel to remove all threats and preserve Federation integrity. Farewell.");
        document.body.style.backgroundColor = "darkred";
        redAlertSound.play();
      } else {
        addResponse("I do not believe that is correct. Check your notes.");
      }
    }

    voiceToggle.addEventListener("click", () => {
      voiceEnabled = !voiceEnabled;
      voiceToggle.textContent = `Voice: ${voiceEnabled ? "On" : "Off"}`;
      if (!voiceEnabled) {
        speechSynthesis.cancel();
      }
    });

    document.getElementById("user-input").addEventListener("keypress", function (e) {
      if (e.key === "Enter") {
        handleInput();
      }
    });
  </script>
</body>
</html>
