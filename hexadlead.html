<!DOCTYPE html>
<html>
<head>
<title>Hexad Lead Gen</title>

<style>
:root {
  --green: #6bb841;
  --dark: #0f172a;
  --card: #111827;
  --text: #e5e7eb;
}

body {
  font-family: system-ui;
  background: var(--dark);
  color: var(--text);
  margin: 0;
}

.container {
  max-width: 1200px;
  margin: auto;
  padding: 30px;
}

h1 {
  color: var(--green);
  margin-bottom: 10px;
}

.card {
  background: var(--card);
  padding: 20px;
  border-radius: 10px;
  margin-bottom: 20px;
  box-shadow: 0 0 20px rgba(0,0,0,.4);
}

input, select, textarea {
  width: 100%;
  padding: 8px;
  margin: 6px 0;
  background: #020617;
  border: 1px solid #1f2937;
  color: white;
  border-radius: 6px;
}

button {
  background: var(--green);
  border: none;
  padding: 10px 16px;
  color: black;
  font-weight: bold;
  border-radius: 6px;
  cursor: pointer;
}

button:hover {
  filter: brightness(1.1);
}

table {
  width: 100%;
  border-collapse: collapse;
}

th {
  background: #020617;
  color: var(--green);
  padding: 8px;
}

td {
  padding: 6px;
  border-bottom: 1px solid #1f2937;
}

tr:hover {
  background: #020617;
}

.edit-btn {
  background: #1f2937;
  color: var(--green);
  padding: 4px 8px;
  font-size: 12px;
}
</style>
</head>
<body>

<div class="container">

<h1>Hexad Lead Gen</h1>

<div class="card">
<h3>Add / Edit Lead</h3>

<input id="row" type="hidden">
<input id="user" placeholder="Your Name">
<select id="company"></select>
<input id="name" placeholder="Contact Name">
<input id="phone" placeholder="Phone">
<input id="email" placeholder="Email">

<select id="method">
<option>Phone</option>
<option>Email</option>
<option>LinkedIn</option>
<option>In Person</option>
</select>

<select id="status">
<option>No Reply</option>
<option>Not Interested</option>
<option>Interested</option>
<option>Meeting Set</option>
</select>

<textarea id="notes" placeholder="Notes"></textarea>

<button onclick="saveLead()">Save</button>
<p id="msg"></p>
</div>

<div class="card">
<input id="search" placeholder="Search name, company, phone, email" onkeyup="filterTable()">

<table>
<thead>
<tr>
<th>Edit</th>
<th>Date</th>
<th>User</th>
<th>Company</th>
<th>Name</th>
<th>Phone</th>
<th>Email</th>
<th>Status</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>
</div>

</div>

<script>
const API = "https://script.google.com/macros/s/AKfycbyGPic4U9HyDIWORhlrW7y3hwrUnjswMsix6ePXl5Z3stEWX5bk6DeHuPl89j-5UaFwBw/exec";
let allData = [];

async function loadCompanies() {
  let res = await fetch(API + "?action=getCompanies");
  let companies = await res.json();
  company.innerHTML = companies.map(c => `<option>${c}</option>`).join("");
}

async function loadLeads() {
  let res = await fetch(API + "?action=getLeads");
  allData = await res.json();
  renderTable(allData);
}

function renderTable(data) {
  tbody.innerHTML = "";

  data.forEach(r => {
    let tr = document.createElement("tr");

    tr.innerHTML = `
      <td><button class="edit-btn" onclick='editRow(${JSON.stringify(r)})'>Edit</button></td>
      <td>${new Date(r[1]).toLocaleDateString()}</td>
      <td>${r[2]}</td>
      <td>${r[3]}</td>
      <td>${r[4]}</td>
      <td>${r[5]}</td>
      <td>${r[6]}</td>
      <td>${r[8]}</td>
    `;

    tbody.appendChild(tr);
  });
}

function filterTable() {
  let term = search.value.toLowerCase();
  let filtered = allData.filter(r => r.join(" ").toLowerCase().includes(term));
  renderTable(filtered);
}

function editRow(r) {
  row.value = r[0];
  user.value = r[2];
  company.value = r[3];
  name.value = r[4];
  phone.value = r[5];
  email.value = r[6];
  method.value = r[7];
  status.value = r[8];
  notes.value = r[9];

  window.scrollTo({ top: 0, behavior: 'smooth' });
}

async function saveLead() {
  let data = {
    row: row.value,
    user: user.value,
    company: company.value,
    name: name.value,
    phone: phone.value,
    email: email.value,
    method: method.value,
    status: status.value,
    notes: notes.value
  };

  let res = await fetch(API, {
    method: "POST",
    body: JSON.stringify(data)
  });

  let result = await res.json();
  msg.innerText = result.result;
  row.value = "";
  loadLeads();
}

loadCompanies();
loadLeads();
</script>

</body>
</html>
