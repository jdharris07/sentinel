<!DOCTYPE html>
<html>
<head>
<title>Hexad Lead Gen</title>
<style>
body { font-family: Arial; max-width: 1100px; margin: 30px auto; }
input, select, textarea, button {
  margin: 5px;
  padding: 6px;
}
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 20px;
}
th, td {
  border: 1px solid #ccc;
  padding: 6px;
  font-size: 14px;
}
th { background: #f4f4f4; }
</style>
</head>
<body>

<h1>Hexad Lead Gen</h1>

<h3>Add Lead</h3>

<input id="user" placeholder="Your Name">

<select id="company"></select>

<input id="name" placeholder="Contact Name">
<input id="phone" placeholder="Phone">
<input id="email" placeholder="Email">

<select id="method">
<option>Phone</option>
<option>Email</option>
<option>LinkedIn</option>
<option>In Person</option>
</select>

<select id="status">
<option>No Reply</option>
<option>Not Interested</option>
<option>Interested</option>
<option>Meeting Set</option>
</select>

<textarea id="notes" placeholder="Notes"></textarea>

<button onclick="saveLead()">Save Lead</button>
<p id="msg"></p>

<hr>

<h3>Search</h3>
<input id="search" placeholder="Search name, company, phone, email" onkeyup="filterTable()">

<table id="leadsTable">
<thead>
<tr>
<th>Date</th>
<th>User</th>
<th>Company</th>
<th>Name</th>
<th>Phone</th>
<th>Email</th>
<th>Method</th>
<th>Status</th>
<th>Notes</th>
</tr>
</thead>
<tbody></tbody>
</table>

<script>
const API = "https://script.google.com/macros/s/AKfycbxE8uhSVymk000ljsT4hMj2Lb1Ckjjdc3ihxDr_8xi0HEeagMP_C_kgxS989GkOD1hOtg/exec";

let allData = [];

async function loadCompanies() {
  let res = await fetch(API + "?action=getCompanies");
  let companies = await res.json();
  let select = document.getElementById("company");

  companies.forEach(c => {
    let opt = document.createElement("option");
    opt.text = c;
    select.add(opt);
  });
}

async function loadLeads() {
  let res = await fetch(API + "?action=getLeads");
  allData = await res.json();
  renderTable(allData);
}

function renderTable(data) {
  let tbody = document.querySelector("#leadsTable tbody");
  tbody.innerHTML = "";

  data.forEach(row => {
    let tr = document.createElement("tr");
    row.forEach(cell => {
      let td = document.createElement("td");
      td.textContent = cell;
      tr.appendChild(td);
    });
    tbody.appendChild(tr);
  });
}

function filterTable() {
  let term = document.getElementById("search").value.toLowerCase();

  let filtered = allData.filter(row =>
    row.join(" ").toLowerCase().includes(term)
  );

  renderTable(filtered);
}

async function saveLead() {
  let data = {
    user: user.value,
    company: company.value,
    name: name.value,
    phone: phone.value,
    email: email.value,
    method: method.value,
    status: status.value,
    notes: notes.value
  };

  let res = await fetch(API, {
    method: "POST",
    body: JSON.stringify(data)
  });

  let result = await res.json();

  if (result.result === "duplicate") {
    msg.innerText = "Duplicate detected (phone or email already exists)";
  } else {
    msg.innerText = "Lead saved";
    loadLeads();
  }
}

loadCompanies();
loadLeads();
</script>

</body>
</html>

