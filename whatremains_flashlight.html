<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover" />
<title>Morse Flashlight â€¢ Click to View</title>
<style>
  :root{
    /* Your hard-coded alignment/sizing values */
    --x: 57.9;
    --y: 68.7;
    --diam: 31.9;
  }
  html,body{height:100%}
  body{
    margin:0; background:#0a0c10; color:#eaf1ff;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
    display:grid; place-items:center;
  }
  .stage{
    width:min(94vw, 720px);
    aspect-ratio:1/1;
    position:relative;
    overflow:hidden;
    border-radius:14px;
    background: center / contain no-repeat url("wrflashlight.png"), #000;
    box-shadow: 0 10px 22px rgba(0,0,0,.45), inset 0 0 0 1px rgba(255,255,255,.06);
  }
  .flash{
    position:absolute; left:calc(var(--x)*1%); top:calc(var(--y)*1%);
    width:calc(var(--diam)*1%); aspect-ratio:1/1; transform:translate(-50%,-50%); border-radius:50%;
    background: radial-gradient(circle at 50% 45%, #1b1b1b 0%, #0d0d0d 55%, #000 100%);
    box-shadow: inset 0 0 120px #000;
  }
  .flash.on{
    background: radial-gradient(circle at 48% 45%, #fff 0%, #f6f8ff 20%, #dfe8ff 34%, #b7c9ff38 62%, #0000 80%);
    box-shadow: 0 0 120px 40px rgba(255,255,255,.18),
                0 0 220px 90px rgba(155,183,255,.18),
                inset 0 0 160px rgba(255,255,255,.9);
  }

  /* Overlay */
  .overlay{
    position:absolute; inset:0;
    display:grid; place-items:center;
    background: linear-gradient(180deg, rgba(0,0,0,.35), rgba(0,0,0,.55));
    backdrop-filter: blur(2px);
    z-index: 5;
  }
  .cta{
    appearance:none; border:1px solid #3a4b70; background:#162245; color:#eaf1ff;
    padding:14px 18px; border-radius:12px; font-weight:700; font-size:16px;
    box-shadow: 0 6px 18px rgba(0,0,0,.35);
    cursor:pointer;
  }
  .cta:disabled{opacity:.6; cursor:not-allowed}
  .cta:focus-visible{outline:2px solid #7ea2ff; outline-offset:3px; box-shadow:0 0 0 4px rgba(126,162,255,.25)}
  .visually-hidden{position:absolute!important;height:1px;width:1px;overflow:hidden;clip:rect(1px,1px,1px,1px);white-space:nowrap}
</style>
</head>
<body>
  <div class="stage" aria-label="Flashlight image with Morse light">
    <div id="flash" class="flash" aria-hidden="true"></div>

    <!-- Click-to-view overlay -->
    <div id="overlay" class="overlay" role="dialog" aria-modal="true" aria-labelledby="ctaLabel">
      <span id="ctaLabel" class="visually-hidden">Start playback</span>
      <button id="cta" class="cta">Click to View</button>
    </div>
  </div>

<script>
(() => {
  // Morse map
  const MORSE = {
    A:".-",B:"-...",C:"-.-.",D:"-..",E:".",F:"..-.",G:"--.",H:"....",I:"..",J:".---",
    K:"-.-",L:".-..",M:"--",N:"-.",O:"---",P:".--.",Q:"--.-",R:".-.",S:"...",T:"-",
    U:"..-",V:"...-",W:".--",X:"-..-",Y:"-.--",Z:"--..",
    "0":"-----","1":".----","2":"..---","3":"...--","4":"....-",
    "5":".....","6":"-....","7":"--...","8":"---..","9":"----.",
    ".":".-.-.-", ",":"--..--", "?":"..--..", "'":".----.", "!":"-.-.--",
    "/":"-..-.", "(":"-.--.", ")":"-.--.-", "&":".-...",  ":":"---...",
    ";":"-.-.-.", "=":"-...-", "+":".-.-.", "-":"-....-", "_":"..--.-",
    '"':".-..-.", "$":"...-..-", "@":".--.-."
  };

  // Your settings
  const MSG  = "BUY IT TODAY";
  const UNIT = 350;   // dot length (ms)
  const GAP  = 1;     // extra spacing units

  const flashEl = document.getElementById('flash');
  const overlay = document.getElementById('overlay');
  const cta     = document.getElementById('cta');

  function toSequence(text, unit, gapBoost=0){
    const seq=[], words=text.toUpperCase().split(/\s+/);
    const gap=u=>{ if(u>0) seq.push({on:false,duration:u*unit}); };
    const on=u=>seq.push({on:true,duration:u*unit});
    words.forEach((w,wi)=>{
      for(let i=0;i<w.length;i++){
        const pat=MORSE[w[i]];
        if(!pat) continue;
        for(let j=0;j<pat.length;j++){
          on(pat[j]==='.'?1:3);
          if(j<pat.length-1) gap(1+gapBoost);
        }
        if(i<w.length-1) gap(3+gapBoost);
      }
      if(wi<words.length-1) gap(7+gapBoost);
    });
    return seq;
  }
  const sleep = ms => new Promise(r=>setTimeout(r,ms));

  async function playOnce(){
    const seq = toSequence(MSG, UNIT, GAP);
    for(const step of seq){
      flashEl.classList.toggle('on', step.on);
      await sleep(step.duration);
    }
    flashEl.classList.remove('on');
  }

  async function handleStart(){
    cta.disabled = true;
    overlay.style.display = 'none';           // hide overlay
    try { await playOnce(); }
    finally {
      // Bring overlay back after one run
      overlay.style.display = 'grid';
      cta.disabled = false;
      // Return focus for accessibility
      cta.focus({preventScroll:true});
    }
  }

  cta.addEventListener('click', handleStart);
  // Keyboard: Enter/Space also starts it when overlay focused
  overlay.addEventListener('keydown', (e)=>{
    if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); handleStart(); }
  });
})();
</script>
</body>
</html>
