<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport"
  content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover" />
<title>K2 EMF — Mobile</title>
<style>
  :root{
    --bg:#0a0f18; --ink:#e7f0ff; --muted:#aebedb; --grid:#23314a;
    --tile:#0e1524; --tile2:#121b2c; --rad:14px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; background:linear-gradient(180deg,#060912,#0e1423);
    color:var(--ink);
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
    -webkit-font-smoothing:antialiased;
  }

  header{
    position:sticky; top:0; z-index:10;
    padding: max(10px, env(safe-area-inset-top)) 16px 8px;
    background:rgba(10,15,25,.9);
    border-bottom:1px solid #1c2740;
    display:flex; align-items:center; justify-content:space-between; gap:12px;
  }
  h1{margin:0; font-size:16px; letter-spacing:.3px}
  .btn{
    appearance:none; border:1px solid #2a3a5a; background:#132139; color:var(--ink);
    padding:8px 12px; border-radius:10px; font-weight:700; font-size:13px;
  }

  .wrap{
    padding:10px max(10px, env(safe-area-inset-left)) max(10px, env(safe-area-inset-bottom)) max(10px, env(safe-area-inset-right));
  }

  /* Field takes almost the whole viewport height in portrait */
  .field{
    position:relative;
    width:100%;
    max-width:600px;
    margin:0 auto;
    aspect-ratio: 9 / 16;                  /* Portrait-first */
    background:linear-gradient(180deg,var(--tile),var(--tile2));
    border:1px solid var(--grid); border-radius:12px;
    box-shadow: inset 0 10px 28px rgba(0,0,0,.45);
    overflow:hidden;
    touch-action:none;
  }
  /* Subtle grid (dev only) */
  .field.dev::before{
    content:""; position:absolute; inset:0; pointer-events:none; opacity:.25;
    background:
      linear-gradient(#1b2943 1px, transparent 1px),
      linear-gradient(90deg,#1b2943 1px, transparent 1px);
    background-size: 8% 8%;
  }

  /* Hotspots scale by percent; hidden by default for gameplay */
  .hotspot{
    position:absolute;
    border:1px dashed transparent; border-radius:10px;
    background:transparent; color:transparent; display:grid; place-items:center;
    font-size:12px; padding:4px;
  }
  .field.dev .hotspot{ border-color:#2b3c5f; background:rgba(255,255,255,.03); color:var(--muted); }
  .hotspot.active{ outline:2px solid #7ee2b8; box-shadow:0 0 0 2px rgba(126,226,184,.25) }

  /* Draggable K2 meter */
  .meter{
    position:absolute;
    width: clamp(120px, 32vw, 220px);
    left: 3%; bottom: 6%;
    user-select:none; -webkit-user-drag:none; cursor:grab; touch-action:none;
  }
  .meter.dragging{ cursor:grabbing }
  .meter img{display:block; width:100%; height:auto; pointer-events:none}

  /* LED overlay positioned relative to image bounds */
  .leds{ position:absolute; left:6%; top:5%; width:88%; height:19%; pointer-events:none }
  .led{
    position:absolute; width:16%; aspect-ratio:1/1; border-radius:50%;
    opacity:.18; transform:translate(-50%,-50%);
    background: radial-gradient(circle at 50% 55%, rgba(255,255,255,.35) 0 28%, rgba(255,255,255,.05) 29% 55%, rgba(0,0,0,.15) 56% 100%);
  }
  .led.l1{ left:14%; top:50%; --col:#33d16a }  /* green */
  .led.l2{ left:33%; top:42%; --col:#27c15b }  /* green */
  .led.l3{ left:52%; top:36%; --col:#f1d44e }  /* yellow */
  .led.l4{ left:71%; top:42%; --col:#ff8a3d }  /* orange */
  .led.l5{ left:88%; top:50%; --col:#ff4b4b }  /* red   */
  .led.on{
    opacity:1;
    box-shadow: 0 0 6px var(--col), 0 0 18px color-mix(in srgb, var(--col) 55%, transparent);
    background: radial-gradient(circle at 50% 55%, #fff 0 18%, color-mix(in srgb, var(--col) 70%, #fff) 19% 52%, color-mix(in srgb, var(--col) 85%, #000) 53% 100%);
  }

  /* Bottom status bar */
  .status{
    text-align:center; font-size:14px; color:var(--muted);
    margin-top:8px; min-height:22px;
  }
</style>
</head>
<body>
<header>
  <h1>K2 EMF Hotspots</h1>
  <button id="devBtn" class="btn" aria-pressed="false" aria-controls="field">DEV</button>
</header>

<div class="wrap">
  <div id="field" class="field" aria-label="Playfield">
    <!-- Hotspots: position & size in percentages for true responsiveness -->
    <!-- data-x/y = left/top %, data-w/h = width/height %, data-level = 0–5 LEDs -->
    <div class="hotspot" data-x="5"  data-y="6"  data-w="22" data-h="14" data-level="2">2 lights</div>
    <div class="hotspot" data-x="31" data-y="18" data-w="22" data-h="14" data-level="3">3 lights</div>
    <div class="hotspot" data-x="57" data-y="7"  data-w="22" data-h="14" data-level="4">4 lights</div>
    <div class="hotspot" data-x="72" data-y="28" data-w="22" data-h="14" data-level="5">5 lights</div>
    <div class="hotspot" data-x="38" data-y="64" data-w="24" data-h="16" data-level="0">Quiet</div>

    <!-- Draggable meter -->
    <div id="meter" class="meter" aria-label="K2 Meter" role="img">
      <img src="k2meter.png" alt="K2 EMF meter" />
      <div class="leds">
        <span class="led l1"></span>
        <span class="led l2"></span>
        <span class="led l3"></span>
        <span class="led l4"></span>
        <span class="led l5"></span>
      </div>
    </div>
  </div>

  <div id="status" class="status" aria-live="polite"></div>
</div>

<script>
const field = document.getElementById('field');
const meter = document.getElementById('meter');
const statusEl = document.getElementById('status');
const devBtn = document.getElementById('devBtn');
const leds = [...meter.querySelectorAll('.led')];
const hotspots = [...field.querySelectorAll('.hotspot')];

let dragging = false;
let start = {x:0, y:0};
let offset = {x: meter.offsetLeft, y: meter.offsetTop};
let lastLevel = -1;

/* Place hotspots by % so they scale on any screen */
function layoutHotspots(){
  const rect = field.getBoundingClientRect();
  hotspots.forEach(h=>{
    const x = parseFloat(h.dataset.x), y = parseFloat(h.dataset.y);
    const w = parseFloat(h.dataset.w), hgt = parseFloat(h.dataset.h);
    h.style.left = x + '%';
    h.style.top = y + '%';
    h.style.width = w + '%';
    h.style.height = hgt + '%';
  });
}
window.addEventListener('resize', layoutHotspots);
layoutHotspots();

/* Utility rect + overlap */
function rect(el){ return el.getBoundingClientRect(); }
function overlapRatio(a, b){
  const x1 = Math.max(a.left, b.left);
  const y1 = Math.max(a.top,  b.top);
  const x2 = Math.min(a.right, b.right);
  const y2 = Math.min(a.bottom,b.bottom);
  const w = Math.max(0, x2 - x1);
  const h = Math.max(0, y2 - y1);
  const inter = w*h;
  const area = (b.width * b.height);
  return area ? inter / area : 0;
}

/* Lights + haptics */
function setLights(n){
  leds.forEach((el, i)=> el.classList.toggle('on', i < n));
  if(n !== lastLevel){
    if('vibrate' in navigator){ navigator.vibrate(n ? [15] : 0); }
    statusEl.textContent = n===1 ? `Level: ${n} light` : `Level: ${n} lights`;
    lastLevel = n;
  }
}

/* Find best overlapping hotspot */
function highlightHotspot(active){
  hotspots.forEach(h => h.classList.toggle('active', h === active));
}
function checkHotspots(){
  const m = rect(meter);
  let best = null, bestRatio = 0;
  for(const h of hotspots){
    const r = rect(h);
    const ratio = overlapRatio(m, r);
    if(ratio > bestRatio){ bestRatio = ratio; best = h; }
  }
  const THRESH = 0.25; // % of hotspot overlapped to count
  if(best && bestRatio >= THRESH){
    highlightHotspot(best);
    const level = parseInt(best.dataset.level || '0', 10);
    setLights(level);
  }else{
    highlightHotspot(null);
    setLights(0);
  }
}

/* Drag handling (pointer events work for touch + mouse) */
function clamp(val, min, max){ return Math.min(max, Math.max(min, val)); }
function moveTo(x, y){
  const maxX = field.clientWidth - meter.clientWidth;
  const maxY = field.clientHeight - meter.clientHeight;
  offset.x = clamp(x, 0, maxX);
  offset.y = clamp(y, 0, maxY);
  meter.style.left = offset.x + 'px';
  meter.style.top  = offset.y + 'px';
  checkHotspots();
}

meter.addEventListener('pointerdown', (e)=>{
  dragging = true;
  meter.setPointerCapture(e.pointerId);
  meter.classList.add('dragging');
  start.x = e.clientX - offset.x;
  start.y = e.clientY - offset.y;
  e.preventDefault();
});
meter.addEventListener('pointermove', (e)=>{
  if(!dragging) return;
  moveTo(e.clientX - start.x, e.clientY - start.y);
  e.preventDefault();
});
meter.addEventListener('pointerup', (e)=>{
  dragging = false;
  meter.classList.remove('dragging');
  meter.releasePointerCapture?.(e.pointerId);
});
meter.addEventListener('pointercancel', ()=>{
  dragging = false;
  meter.classList.remove('dragging');
});

/* DEV toggle (shows grid + hotspot boxes) */
devBtn.addEventListener('click', ()=>{
  const on = !field.classList.contains('dev');
  field.classList.toggle('dev', on);
  devBtn.setAttribute('aria-pressed', on ? 'true' : 'false');
});

/* Init */
setLights(0);
checkHotspots();
</script>
</body>
</html>
